ULTRATHINKING: Review Mode Deletion Bug Fix
============================================

THE BUG
-------
User pressed "2" (delete) in review mode, but worktree wasn't actually deleted.
When re-entering review, the "deleted" worktree was still there.

ROOT CAUSE ANALYSIS
-------------------
1. **Silent Failure**: remove_worktree() was returning False (failure) but
   review code wasn't checking the return value

2. **Project Not Found**: remove_worktree() requires finding the project path
   to run `git worktree remove`. It was using get_project_for_worktree() which
   only worked if the project name was in the PROJECTS list.

3. **Break Anyway**: Even when deletion failed, the code would `break` from
   the loop, making it seem like it succeeded.

Example failure:
- Worktree: canada-claude-20251031-223631-single
- Looking for project: "canada"
- Not in PROJECTS list: [aios, waylandauto, Workcycle, testRepoPrivate]
- Result: Can't find project → Can't delete → Silent failure

THE FIX (Library Glue Approach)
--------------------------------

Fix 1: Check Return Values
```python
# Before (bug):
elif action == '2':
    remove_worktree(wt_path, push=False, skip_confirm=True)
    break  # Always breaks, even on failure!

# After (fixed):
elif action == '2':
    if remove_worktree(wt_path, push=False, skip_confirm=True):
        print("✓ Worktree removed")
        break
    else:
        print("✗ Failed to remove worktree - check project association")
        continue  # Stay in loop, let user try again
```

Fix 2: Smarter Project Detection
```python
def get_project_for_worktree(worktree_path):
    # Try matching to PROJECTS list first (original method)
    ...

    # NEW FALLBACK: Read .git file directly
    git_file = os.path.join(worktree_path, '.git')
    if os.path.isfile(git_file):
        with open(git_file, 'r') as f:
            content = f.read().strip()
            # Parse: gitdir: /path/to/repo/.git/worktrees/name
            if content.startswith('gitdir: '):
                gitdir = content.replace('gitdir: ', '')
                # Extract main repo path
                if '/.git/worktrees/' in gitdir:
                    project_path = gitdir.split('/.git/worktrees/')[0]
                    return project_path
```

HOW IT WORKS NOW
----------------
1. User presses "2" for delete
2. remove_worktree() is called
3. get_project_for_worktree() tries:
   a. Match worktree name to PROJECTS list
   b. If fails, read .git file to find project
4. With project path, run: git -C project worktree remove path
5. Check return value:
   - Success: Show "✓", break from loop
   - Failure: Show "✗", continue loop (user can retry)

LIBRARY FUNCTIONS USED
----------------------
- open() - read .git file
- str.startswith() - check gitdir prefix
- str.split() - extract project path
- os.path.isfile() - check .git exists
- if/else - handle return values

TESTING
-------
Before fix:
- Deletion appeared to work but didn't
- Worktree remained on disk
- User confused

After fix:
- Clear success/failure messages
- Actually deletes worktree
- Fallback to .git file works for any worktree

UNIX PHILOSOPHY
---------------
- Be explicit about failures (no silent errors)
- Use existing information (.git file)
- Simple text parsing (gitdir: path)
- Return values matter (check them!)

USER EXPERIENCE
---------------
Before: "I deleted it but it's still there?!"
After: "✓ Worktree removed" or "✗ Failed - let me try again"

The fix is minimal (15 lines added) but solves a critical bug that made
the review mode appear broken. Now deletion actually works!