ULTRATHINKING: Agent Session Review Mode
=========================================

KEY INSIGHT
-----------
Worktrees are created BY AI agents (codex, claude, gemini). The tmux session
running the agent has the SAME NAME as the worktree. Reviewing means reviewing
the AGENT'S work, not just browsing files.

PROBLEM SOLVED
--------------
User wants to:
1. See what the agent did (output, errors, conversation)
2. Potentially interact with agent if still running
3. Understand the context before deciding to push/delete
4. Review agent logs, not just file changes

SOLUTION (Pure Library Glue)
-----------------------------
# Check if agent session exists (worktree name = session name)
agent_session_exists = sp.run(['tmux', 'has-session', '-t', wt_name],
                              capture_output=True).returncode == 0

if agent_session_exists:
    # Attach to AGENT session to see its work
    session_to_attach = wt_name  # The agent's session
else:
    # No agent = create review session for files
    session_to_attach = f"review-{idx}"

IMPLEMENTATION
--------------
Lines changed: ~20
Functions used:
- tmux has-session: Check if agent session exists
- tmux attach-session: Attach to agent or review session
- str.startswith(): Identify review sessions for cleanup

USER EXPERIENCE
---------------

Scenario 1: Agent Session Still Running
----------------------------------------
[1/20] testRepoPrivate-codex-20251104-135909-single
Age: 0d 2h
ü§ñ Found agent session: testRepoPrivate-codex-20251104-135909-single
üí° Review agent output, then detach: Ctrl+B D
Opening: /home/seanpatten/projects/aiosWorktrees/testRepoPrivate-codex...

[Attaches to CODEX session]
User sees:
- Agent's full conversation
- Errors/warnings
- Current status
- Can interact with agent if needed

Scenario 2: Agent Session Finished
-----------------------------------
[2/20] aios-claude-20251101-220039-multi-0
Age: 7d 0h
üìÅ No agent session, creating file browser
üí° Browse files, then detach: Ctrl+B D
Opening: /home/seanpatten/projects/aiosWorktrees/aios-claude...

[Creates new review session]
User sees:
- Fresh bash prompt in worktree
- Can browse files, check git status
- No agent conversation available

VISUAL INDICATORS
-----------------
ü§ñ = Agent session found (see agent's work)
üìÅ = No agent session (browse files only)

This immediately tells user what they'll see!

WHY THIS MATTERS
----------------
1. **Context**: Agent output shows WHY changes were made
2. **Debugging**: See errors/issues the agent encountered
3. **Understanding**: Read agent's reasoning and decisions
4. **Interaction**: Can ask agent questions if still running
5. **Trust**: Verify agent did what was expected

WORKFLOW COMPARISON
-------------------

OLD (Wrong):
1. Look for tmux session IN the worktree directory
2. Always create new session
3. User only sees files, no context

NEW (Correct):
1. Look for tmux session WITH worktree name (agent)
2. Attach to agent session if exists
3. User sees agent's work and conversation

UNIX PHILOSOPHY
---------------
- One source of truth: Session name = Worktree name
- Compose existing tools: tmux has-session, attach-session
- Do one thing well: Show agent work OR file browser
- Be explicit: ü§ñ vs üìÅ icons show what you'll get

LIBRARY GLUE PATTERN
--------------------
No custom session management, just:
1. tmux has-session -t name (check)
2. tmux attach-session -t name (attach)
3. tmux new-session -d -s name (create)

All standard tmux commands, no wrapper logic!

REAL WORLD EXAMPLE
------------------
Worktree: aios-codex-20251104-144844-single

This was created by:
- Agent: codex
- Project: aios
- Time: Nov 4, 14:48:44
- Mode: single

The tmux session "aios-codex-20251104-144844-single" contains:
- Codex's conversation with user
- Commands it ran
- Errors it encountered
- Files it created/modified
- Reasoning for changes

Reviewing this session shows the STORY, not just the RESULT.

BENEFITS
--------
1. **Full Context**: See WHY changes were made
2. **Error Visibility**: Understand what went wrong
3. **Learning**: See how agent solved problems
4. **Quality Check**: Verify agent's approach
5. **Interaction**: Continue conversation if needed

This is the difference between:
- "Here are some file changes" (old)
- "Here's what the agent did and why" (new)

The implementation is minimal but the UX improvement is massive!